<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>INVS Squad Submission</title>
<style>
  body {
    font-family: sans-serif;
    background: #121212;
    color: white;
    max-width: 480px;
    margin: 2rem auto;
    padding: 1rem;
  }
  input, button {
    width: 100%;
    padding: 0.75rem;
    margin-top: 1rem;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
  }
  input {
    background: #222;
    color: white;
  }
  button {
    background: #28a745;
    color: white;
    cursor: pointer;
  }
  .success {
    margin-top: 1rem;
    color: #0f0;
  }
  .error {
    margin-top: 1rem;
    color: #f44;
  }
  .flag {
    width: 32px;
    height: 24px;
    margin: 0 5px;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid #444;
  }
  #langSelector {
    text-align: center;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>

<div id="langSelector">
  <img src="https://flagcdn.com/32x24/gb.png" class="flag" data-lang="en" title="English" alt="English" />
  <img src="https://flagcdn.com/32x24/es.png" class="flag" data-lang="es" title="Español" alt="Español" />
  <img src="https://flagcdn.com/32x24/de.png" class="flag" data-lang="de" title="Deutsch" alt="Deutsch" />
  <img src="https://flagcdn.com/32x24/fr.png" class="flag" data-lang="fr" title="Français" alt="Français" />
  <img src="https://flagcdn.com/32x24/it.png" class="flag" data-lang="it" title="Italiano" alt="Italiano" />
  <img src="https://flagcdn.com/32x24/pl.png" class="flag" data-lang="pl" title="Polski" alt="Polski" />
</div>

<h1 id="pageTitle">Submit Your Squad Power</h1>

<form action="https://script.google.com/macros/s/AKfycbz0Ea_CvxzLn6VM0OpIBcaWzXD-Y8e27jlZ8fSmBFaiccmb3Y7XK_XempA4PAwyM8LV/exec" method="POST" target="hidden_iframe">
  <input type="text" name="name" required />
  <input type="text" name="squadPower" required />
  <button type="submit">Submit</button>
</form>
<iframe name="hidden_iframe" style="display:none;"></iframe>

<div id="message"></div>

<script>
  const translations = {
    en: {
      title: "Submit Your Squad Power",
      name: "Your Name",
      power: "Squad Power (e.g. 32.5M or 34500000)",
      submit: "Submit",
      success: "✅ Submitted successfully!",
      error: "❌ Error submitting. Try again later.",
      invalid: "❌ Invalid input."
    },
    es: {
      title: "Enviar poder del escuadrón",
      name: "Tu nombre",
      power: "Poder del escuadrón (p. ej. 32.5M o 34500000)",
      submit: "Enviar",
      success: "✅ ¡Enviado con éxito!",
      error: "❌ Error al enviar. Intenta más tarde.",
      invalid: "❌ Entrada no válida."
    },
    de: {
      title: "Sende deine Truppenstärke",
      name: "Dein Name",
      power: "Truppenstärke (z. B. 32.5M oder 34500000)",
      submit: "Senden",
      success: "✅ Erfolgreich gesendet!",
      error: "❌ Fehler beim Senden. Versuche es später erneut.",
      invalid: "❌ Ungültige Eingabe."
    },
    fr: {
      title: "Soumettez votre puissance d'escouade",
      name: "Votre nom",
      power: "Puissance d'escouade (ex. 32.5M ou 34500000)",
      submit: "Soumettre",
      success: "✅ Envoyé avec succès !",
      error: "❌ Erreur lors de l'envoi. Réessayez plus tard.",
      invalid: "❌ Entrée invalide."
    },
    it: {
      title: "Invia la potenza della tua squadra",
      name: "Il tuo nome",
      power: "Potenza della squadra (es. 32.5M o 34500000)",
      submit: "Invia",
      success: "✅ Inviato con successo!",
      error: "❌ Errore nell'invio. Riprova più tardi.",
      invalid: "❌ Inserimento non valido."
    },
    pl: {
      title: "Prześlij siłę swojej drużyny",
      name: "Twoje imię",
      power: "Siła drużyny (np. 32.5M lub 34500000)",
      submit: "Wyślij",
      success: "✅ Pomyślnie wysłano!",
      error: "❌ Błąd podczas wysyłania. Spróbuj później.",
      invalid: "❌ Nieprawidłowe dane."
    }
  };

  const form = document.getElementById('submitForm');
  const nameInput = document.getElementById('name');
  const powerInput = document.getElementById('squadPower');
  const messageDiv = document.getElementById('message');
  const submitButton = form.querySelector('button');
  const pageTitle = document.getElementById('pageTitle');

  function setLanguage(lang) {
    const t = translations[lang] || translations.en;
    pageTitle.textContent = t.title;
    nameInput.placeholder = t.name;
    powerInput.placeholder = t.power;
    submitButton.textContent = t.submit;
    messageDiv.textContent = '';
    messageDiv.className = '';
    localStorage.setItem('inv_lang', lang);
  }

  // Load stored username and language, and apply language
  window.addEventListener('DOMContentLoaded', () => {
    const savedName = localStorage.getItem('inv_username');
    if (savedName) {
      nameInput.value = savedName;
    }

    const savedLang = localStorage.getItem('inv_lang');
    const browserLang = navigator.language.slice(0,2).toLowerCase();
    const supportedLangs = Object.keys(translations);
    const langToUse = savedLang || (supportedLangs.includes(browserLang) ? browserLang : 'en');
    setLanguage(langToUse);
  });

  // Language selector flag clicks
  document.querySelectorAll('.flag').forEach(flag => {
    flag.addEventListener('click', () => {
      setLanguage(flag.dataset.lang);
    });
  });

  form.addEventListener('submit', async e => {
    e.preventDefault();
    messageDiv.textContent = '';
    messageDiv.className = '';

    let rawName = nameInput.value;
    const name = rawName.trim().toLowerCase();

    let rawPower = powerInput.value.trim().replace(',', '.');

    // Parse squad power, supporting M suffix
    let multiplier = 1;
    if (/m$/i.test(rawPower)) {
      multiplier = 1_000_000;
      rawPower = rawPower.slice(0, -1);
    }
    const squadPower = parseFloat(rawPower) * multiplier;

    if (!name || isNaN(squadPower) || squadPower <= 0) {
      const lang = localStorage.getItem('inv_lang') || 'en';
      messageDiv.textContent = translations[lang].invalid;
      messageDiv.className = 'error';
      return;
    }

    // Disable form inputs during submit
    nameInput.disabled = true;
    powerInput.disabled = true;
    submitButton.disabled = true;

    // Save name for next time
    localStorage.setItem('inv_username', rawName);

    try {
      const response = await fetch('https://script.google.com/macros/s/AKfycbz0Ea_CvxzLn6VM0OpIBcaWzXD-Y8e27jlZ8fSmBFaiccmb3Y7XK_XempA4PAwyM8LV/exec', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name, squadPower})
      });

      if (!response.ok) throw new Error(`HTTP error ${response.status}`);

      const lang = localStorage.getItem('inv_lang') || 'en';
      messageDiv.textContent = translations[lang].success;
      messageDiv.className = 'success';

      powerInput.value = '';
    } catch (err) {
      console.error(err);
      const lang = localStorage.getItem('inv_lang') || 'en';
      messageDiv.textContent = translations[lang].error;
      messageDiv.className = 'error';
    }

    // Re-enable form inputs
    nameInput.disabled = false;
    powerInput.disabled = false;
    submitButton.disabled = false;
  });
</script>

</body>
</html>
