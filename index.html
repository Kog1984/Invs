<script>
  const form = document.getElementById('submitForm');
  const successMsg = document.getElementById('successMessage');
  const nameInput = document.getElementById('name');
  const powerInput = document.getElementById('squadPower');

  // Load saved name from localStorage on page load
  window.addEventListener('DOMContentLoaded', () => {
    const savedName = localStorage.getItem('inv_username');
    if (savedName) {
      nameInput.value = savedName;
    }
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = nameInput.value.trim();
    let squadPowerRaw = powerInput.value.trim().replace(",", "."); // Replace comma with dot
    const squadPower = parseFloat(squadPowerRaw);

    if (!name || isNaN(squadPower)) {
      successMsg.textContent = "❌ Invalid input.";
      return;
    }

    // Save name to localStorage
    try {
      localStorage.setItem('inv_username', name);
    } catch (e) {
      console.warn("Could not access localStorage:", e);
    }

    const data = { name, squadPower };

    try {
      await fetch('https://script.google.com/macros/s/AKfycbz0Ea_CvxzLn6VM0OpIBcaWzXD-Y8e27jlZ8fSmBFaiccmb3Y7XK_XempA4PAwyM8LV/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      successMsg.textContent = "✅ Submitted successfully!";
      powerInput.value = ""; // Keep name, clear squad power
    } catch (error) {
      console.error(error);
      successMsg.textContent = "❌ Error submitting. Try again later.";
    }
  });
</script>
