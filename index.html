<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>INVS Squad Submission</title>
<style>
  body {
    font-family: sans-serif;
    max-width: 480px;
    margin: 2rem auto;
    padding: 1rem;
    background: #121212;
    color: white;
  }
  input, button {
    width: 100%;
    padding: 0.75rem;
    margin-top: 1rem;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
  }
  input {
    background: #222;
    color: white;
  }
  button {
    background: #28a745;
    color: white;
    cursor: pointer;
  }
  .success {
    margin-top: 1rem;
    color: #0f0;
  }
  .error {
    margin-top: 1rem;
    color: #f44;
  }
  .flag {
    width: 32px;
    height: 24px;
    margin: 0 5px;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid #444;
    display: inline-block;
  }
  #langSelector {
    text-align: center;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>

<div id="langSelector">
  <img src="https://flagcdn.com/32x24/gb.png" class="flag" data-lang="en" title="English" alt="English" />
  <img src="https://flagcdn.com/32x24/es.png" class="flag" data-lang="es" title="Español" alt="Español" />
  <img src="https://flagcdn.com/32x24/de.png" class="flag" data-lang="de" title="Deutsch" alt="Deutsch" />
  <img src="https://flagcdn.com/32x24/fr.png" class="flag" data-lang="fr" title="Français" alt="Français" />
  <img src="https://flagcdn.com/32x24/it.png" class="flag" data-lang="it" title="Italiano" alt="Italiano" />
  <img src="https://flagcdn.com/32x24/pl.png" class="flag" data-lang="pl" title="Polski" alt="Polski" />
</div>

<h1 id="pageTitle">Submit Your Squad Power</h1>

<form id="submitForm" action="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" method="POST" target="hidden_iframe">
  <input type="text" name="name" id="name" placeholder="Your Name" required />
  <input type="text" name="squadPower" id="squadPower" placeholder="Squad Power (e.g. 32.5M or 34500000)" required />
  <button type="submit">Submit</button>
</form>

<iframe name="hidden_iframe" style="display:none;"></iframe>

<div id="message"></div>

<script>
  // Translations for UI
  const translations = {
    en: {
      title: "Submit Your Squad Power",
      name: "Your Name",
      power: "Squad Power (e.g. 32.5M or 34500000)",
      submit: "Submit",
      success: "✅ Submitted successfully!",
      error: "❌ Error submitting. Try again later.",
      invalidName: "❌ Please enter your name.",
      invalidPower: "❌ Please enter your squad power."
    },
    es: {
      title: "Enviar poder del escuadrón",
      name: "Tu nombre",
      power: "Poder del escuadrón (p. ej. 32.5M o 34500000)",
      submit: "Enviar",
      success: "✅ ¡Enviado con éxito!",
      error: "❌ Error al enviar. Intenta más tarde.",
      invalidName: "❌ Por favor ingresa tu nombre.",
      invalidPower: "❌ Por favor ingresa el poder del escuadrón."
    },
    de: {
      title: "Sende deine Truppenstärke",
      name: "Dein Name",
      power: "Truppenstärke (z. B. 32.5M oder 34500000)",
      submit: "Senden",
      success: "✅ Erfolgreich gesendet!",
      error: "❌ Fehler beim Senden. Versuche es später erneut.",
      invalidName: "❌ Bitte gib deinen Namen ein.",
      invalidPower: "❌ Bitte gib deine Truppenstärke ein."
    },
    fr: {
      title: "Soumettez votre puissance d'escouade",
      name: "Votre nom",
      power: "Puissance d'escouade (ex. 32.5M ou 34500000)",
      submit: "Soumettre",
      success: "✅ Envoyé avec succès !",
      error: "❌ Erreur lors de l'envoi. Réessayez plus tard.",
      invalidName: "❌ Veuillez saisir votre nom.",
      invalidPower: "❌ Veuillez saisir la puissance d'escouade."
    },
    it: {
      title: "Invia la potenza della tua squadra",
      name: "Il tuo nome",
      power: "Potenza della squadra (es. 32.5M o 34500000)",
      submit: "Invia",
      success: "✅ Inviato con successo!",
      error: "❌ Errore nell'invio. Riprova più tardi.",
      invalidName: "❌ Inserisci il tuo nome.",
      invalidPower: "❌ Inserisci la potenza della squadra."
    },
    pl: {
      title: "Prześlij siłę swojej drużyny",
      name: "Twoje imię",
      power: "Siła drużyny (np. 32.5M lub 34500000)",
      submit: "Wyślij",
      success: "✅ Pomyślnie wysłano!",
      error: "❌ Błąd podczas wysyłania. Spróbuj później.",
      invalidName: "❌ Proszę podaj swoje imię.",
      invalidPower: "❌ Proszę podaj siłę drużyny."
    }
  };

  // Elements
  const form = document.getElementById('submitForm');
  const nameInput = document.getElementById('name');
  const powerInput = document.getElementById('squadPower');
  const submitButton = form.querySelector('button');
  const messageDiv = document.getElementById('message');
  const pageTitle = document.getElementById('pageTitle');

  // Current language
  let currentLang = localStorage.getItem('inv_lang') || 'en';

  function applyLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('inv_lang', lang);

    const t = translations[lang] || translations.en;

    pageTitle.textContent = t.title;
    nameInput.placeholder = t.name;
    powerInput.placeholder = t.power;
    submitButton.textContent = t.submit;
    messageDiv.textContent = '';
    messageDiv.className = '';

    // Store current language globally
    currentLang = lang;
  }

  // Initialize language on page load
  window.addEventListener('DOMContentLoaded', () => {
    const savedName = localStorage.getItem('inv_username');
    if (savedName) {
      nameInput.value = savedName;
    }
    // Try browser language first if no saved
    if (!localStorage.getItem('inv_lang')) {
      const browserLang = navigator.language.slice(0,2).toLowerCase();
      if (translations[browserLang]) {
        currentLang = browserLang;
      }
    }
    applyLanguage(currentLang);
  });

  // Language flag click handlers
  document.querySelectorAll('.flag').forEach(flag => {
    flag.addEventListener('click', () => {
      applyLanguage(flag.dataset.lang);
    });
  });

  form.addEventListener('submit', e => {
    // Clear message on submit attempt
    messageDiv.textContent = '';
    messageDiv.className = '';

    const t = translations[currentLang] || translations.en;

    // Basic validation
    const name = nameInput.value.trim();
    if (!name) {
      e.preventDefault();
      messageDiv.textContent = t.invalidName;
      messageDiv.className = 'error';
      return;
    }
    let power = powerInput.value.trim().toUpperCase();
    if (!power) {
      e.preventDefault();
      messageDiv.textContent = t.invalidPower;
      messageDiv.className = 'error';
      return;
    }

    // Convert M suffix to raw number before submit
    if (power.endsWith('M')) {
      const num = parseFloat(power.slice(0, -1));
      if (!isNaN(num)) {
        power = (num * 1000000).toString();
        powerInput.value = power;
      }
    }

    // Disable inputs while submitting
    nameInput.disabled = true;
    powerInput.disabled = true;
    submitButton.disabled = true;

    // Save username locally for next time
    localStorage.setItem('inv_username', nameInput.value);
  });

  // Handle iframe load (submission response)
  const iframe = document.querySelector('iframe[name="hidden_iframe"]');
  iframe.addEventListener('load', () => {
    const t = translations[currentLang] || translations.en;

    // Success message
    messageDiv.textContent = t.success;
    messageDiv.className = 'success';

    // Clear power input only (keep name)
    powerInput.value = '';

    // Re-enable inputs
    nameInput.disabled = false;
    powerInput.disabled = false;
    submitButton.disabled = false;
  });
</script>

</body>
</html>
