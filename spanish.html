<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>API-based Spanish Quiz</title>
<style>
body { font-family: sans-serif; text-align: center; padding: 30px; }
.sentence { font-size: 1.5rem; margin: 20px; }
button { padding: 10px 20px; margin: 10px; cursor: pointer; }
.quiz-btn { display: block; margin: 10px auto; width: 250px; }
.result { font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>
<h1>Spanish Quiz</h1>

<div class="sentence" id="spanish-sentence">Loading...</div>
<button onclick="speakSpanish()">üîä Listen</button>

<h3>What does this mean?</h3>
<div id="options"></div>

<div class="result" id="result"></div>
<button onclick="nextQuiz()">Next Quiz</button>

<script>
const subjects = ["I", "You", "He", "She", "We", "They"];
const verbs = ["eat", "drink", "read", "watch", "go to", "play", "want"];
const objects = {
  "eat": ["apples", "bread", "rice"],
  "drink": ["water", "coffee", "milk"],
  "read": ["book", "newspaper", "magazine"],
  "watch": ["TV", "movie"],
  "go to": ["school", "park", "store"],
  "play": ["soccer", "piano", "chess"],
  "want": ["coffee", "water", "tea"]
};

let currentEnglish = '';
let currentSpanish = '';
let score = 0;

// Generate a sensible English sentence
function generateSentence() {
  const subj = subjects[Math.floor(Math.random() * subjects.length)];
  const verb = verbs[Math.floor(Math.random() * verbs.length)];
  const objList = objects[verb];
  const obj = objList[Math.floor(Math.random() * objList.length)];
  currentEnglish = `${subj} ${verb} ${obj}`;
}

// Translate English to Spanish via API
async function translateToSpanish() {
  try {
    const res = await fetch('https://libretranslate.com/translate', {
      method: 'POST',
      body: JSON.stringify({
        q: currentEnglish,
        source: 'en',
        target: 'es',
        format: 'text'
      }),
      headers: { 'Content-Type': 'application/json' }
    });
    const data = await res.json();
    currentSpanish = data.translatedText;
  } catch (e) {
    console.error("Translation failed:", e);
    currentSpanish = "Translation error";
  }
}

// Load a new quiz
async function loadQuiz() {
  document.getElementById('result').textContent = '';
  generateSentence();
  document.getElementById('spanish-sentence').textContent = "Translating...";
  await translateToSpanish();
  document.getElementById('spanish-sentence').textContent = currentSpanish;

  // Build multiple-choice options
  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML = '';
  let options = [currentEnglish];

  while (options.length < 4) {
    generateSentence();
    if (!options.includes(currentEnglish)) options.push(currentEnglish);
  }

  options.sort(() => Math.random() - 0.5);

  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.textContent = opt;
    btn.className = 'quiz-btn';
    btn.onclick = () => checkAnswer(opt);
    optionsDiv.appendChild(btn);
  });
}

function checkAnswer(answer) {
  if (answer === currentEnglish) {
    document.getElementById('result').textContent = '‚úÖ Correct!';
    score++;
  } else {
    document.getElementById('result').textContent = `‚ùå Wrong! Correct: ${currentEnglish}`;
  }
  console.log('Score:', score);
}

function nextQuiz() {
  loadQuiz();
}

function speakSpanish() {
  if (!currentSpanish) return;
  const msg = new SpeechSynthesisUtterance(currentSpanish);
  msg.lang = 'es-ES';
  window.speechSynthesis.speak(msg);
}

// Initialize first quiz
loadQuiz();
</script>
</body>
</html>
